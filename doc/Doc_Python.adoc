= Documentation Python (Partie IOT) - La Bonne Note
:icons: font
:models: models
:experimental:
:incremental:
:numbered:
:toc: macro
:window: _blank
:correction!:

// Useful definitions
:asciidoc: http://www.methods.co.nz/asciidoc[AsciiDoc]
:icongit: icon:git[]
:git: http://git-scm.com/[{icongit}]
:plantuml: https://plantuml.com/fr/[plantUML]

ifndef::env-github[:icons: font]
// Specific to GitHub
ifdef::env-github[]
:correction:
:!toc-title:
:caution-caption: :fire:
:important-caption: :exclamation:
:note-caption: :paperclip:
:tip-caption: :bulb:
:warning-caption: :warning:
:icongit: Git
endif::[]

Équipe de développement : Yannis Gibert, Ahmad KHALIL, Rayan SELLOU (Groupe 12)

toc::[]

= Structure du dossier 

== Fichiers Python
  - connect_linux.py : version Linux du script.
  - connect.py : version Windows du script.

== Fichiers de données 
  - un fichier Json stockant tout l'historique des alertes (le script le crée s'il n'existe pas déjà)
  - un fichier Json stockant tout l'historique des données (le script le crée s'il n'existe pas déjà)
  - un fichier Json stockant juste les données récupérées en temps réel (fichier qui est supprimé puis crée à nouveau à chaque lancement)

= Tutoriel d'installation

== Installer Python

Pour lancer le script Python, assurez-vous d'avoir les bibliothèques requises installées. Voici les bibliothèques nécessaires :

1. `paho.mqtt.client`: Bibliothèque MQTT pour Python.
2. `json`: Module Python pour travailler avec JSON.
3. `configparser`: Module Python pour lire les fichiers de configuration.
4. `os`: Module Python pour des fonctionnalités liées au système d'exploitation.
5. `time` (sous Windows uniquement) : Module Python pour le temps.
6. `datetime`: Module Python pour manipuler les dates et heures.

Si Python n'est pas installé, vous pouvez le télécharger depuis https://www.python.org/downloads/.

Pour installer les bibliothèques Python, ouvrez une invite de commande ou un terminal et saisissez les commandes suivantes :

[source,cmd]
----
pip install paho-mqtt
pip install jsonlib-python3
pip install configparser
pip install datetime
----

== Utiliser le script

Pour lancer l'application :

- Télécharger tous les fichiers du https://github.com/IUT-Blagnac/sae-3-01-devapp-Groupe-12/tree/master/code/IOT/Application%20finale[dossier de l'application finale] comprenant le .JAR (exécutable qui nous sera pas utile ici), les fichiers Python et le fichier de configuration, 

- Assurez-vous que les fichiers Python (scripts python .py), le fichier de configuration (.ini) et les fichiers JSON s'ils sont déjà crées (alerte.json, données.json, logs.json) sont placés dans le même répertoire que le fichier JAR de l'application.

image::https://github.com/IUT-Blagnac/sae-3-01-devapp-Groupe-12/blob/master/doc/Images%20pour%20les%20documentations/Images_IOT/img_dossier_application.png[]

(En jaunes les fichiers de données JSON, en bleu les script python et en rouge l'exécutable de l'application)

Deux méthodes pour lancer l'application :

- Ouvrez une invite de commande et exécutez la commande suivante :

[source,cmd]
----
Python3 connect.py
----

= Architecture du code

== Le fichier de configuration

Le fichier de configuration comporte plusieurs sections : 

- MQTT : comporte le broker, le port et le topic sur lequel se mettre en écoute
- CONFIG : se compose des noms des fichiers, des données choisies, de la fréquence et de l'unité de cette fréquence (utilisé pour l'application)
- ALERT : les seuils d'alertes pour chaque donnée

image::https://github.com/IUT-Blagnac/sae-3-01-devapp-Groupe-12/blob/master/doc/Images%20pour%20les%20documentations/Images_IOT/python1.png[]

Toutes ces données seront récupérés et utilisées dans le script Python : 

image::https://github.com/IUT-Blagnac/sae-3-01-devapp-Groupe-12/blob/master/doc/Images%20pour%20les%20documentations/Images_IOT/python2.png[]

== Les différentes méthodes

Le script python se compose de plusieurs méthodes : 

- calculer_moyenne : permet de calculer la moyenne pour les 10 dernières valeurs, prend en paramètre le tableau de l'historique des valeurs
- ecrire : permet d'écrire les logs / données dans le fichier, prend en paramètre un booléen pour savoir s'il s'agit d'une écriture de log ou de donnée, le nom du fichier dans lequel écrire, l'identifiant de la room (salle), cet identifiant permettra d'ajouter les données au même endroit dans le fichier Json au lieu de les ajouter n'importe où et enfin la data à écrire en elle même
- ecrire_alerte : permet d'écrire les alertes dans le fichier, prend en paramètre l'identifiant de la room (salle) ainsi que l'alerte à écrire
- on_connect : méthode pour se connecter au service MQTT
- on_message : méthode permettant de récupérer les nouveaux messages arrivant sur le bus MQTT
- handler (uniquement sur la version linux) : permet de gérer le signal d'alarme SIGALARM

== Justification du choix pour les fichiers de données

Nous avons examiné plusieurs critères pour déterminer lequel serait le plus adapté à nos besoins spécifiques. Le tableau ci-dessus met en lumière les principaux avantages et inconvénients de chaque format. Après une évaluation approfondie, nous avons conclu que le format JSON offre plusieurs avantages significatifs pour notre cas d'utilisation. Sa facilité de manipulation, sa capacité à stocker des structures complexes et sa lisibilité pour les humains ont été des facteurs décisifs dans notre choix final du format JSON pour le stockage de nos données.

|===
|Critère | JSON | CSV

|Facilité de lecture
|Facile à lire pour les humains grâce à sa structure hiérarchique
|Peut être difficile à lire pour les humains en raison de sa structure tabulaire

|Facilité de manipulation
|Manipulation aisée grâce à sa structure d'objets et d'arrays
|Peut nécessiter un traitement spécifique pour manipuler les données tabulaires

|Taille du fichier
|Peut être plus volumineux en raison de la nature textuelle et répétitive des données
|Généralement plus compact en raison de la simplicité des données stockées

|Compatibilité
|Bien pris en charge par de nombreuses langages et plateformes grâce à sa popularité
|Compatibilité étendue avec de nombreux logiciels et outils

|Structure des données
|Peut stocker des structures complexes et des types de données variés
|Idéal pour des données tabulaires simples, peut nécessiter une transformation pour des structures complexes

|Lisibilité des données
|Les données sont souvent plus lisibles pour les humains en raison de leur structuration
|Peut être moins lisible en raison des séparateurs et des éventuelles valeurs null

|===


